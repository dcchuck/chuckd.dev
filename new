#!/usr/bin/env python3
import readline  # noqa: F401 - enables keybindings for input()
import re
import sys
from datetime import date
from pathlib import Path

BLOG_DIR = Path(__file__).parent / "src" / "content" / "blog"


def slugify(title: str) -> str:
    slug = title.lower()
    slug = re.sub(r"[^a-z0-9\s-]", "", slug)
    slug = re.sub(r"[\s_]+", "-", slug)
    slug = re.sub(r"-+", "-", slug)
    return slug.strip("-")


def main():
    title = input("Title: ").strip()
    if not title:
        print("Title is required")
        return

    description = input("Description: ").strip()

    slug = slugify(title)
    filepath = BLOG_DIR / f"{slug}.md"

    if filepath.exists():
        print(f"Post already exists: {filepath}")
        return

    today = date.today().isoformat()

    content = f"""---
title: {title}
date: {today}
description: {description}
draft: true
---

# {title}

"""

    filepath.write_text(content)
    print(f"Created: {filepath}")


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        sys.exit(1)
